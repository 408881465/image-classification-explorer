(window.webpackJsonpsac=window.webpackJsonpsac||[]).push([[0],{153:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAvklEQVQ4jaWTMQrCQBBFn0sKT+ABRFKIiHey8iQiwcJCxFN4ADGtpYWVXQobSxFsRL7NhpjVjWaz8Lt5f2d254NzBLEgERwEV6ujYCHou/XvYCSYCR4CefQULAXtb/CmAnS1LZkIpjXgXOsc7v1ou2qcoQHGQOR9HP8xwATBPuD2XKeW4AJ0AjoAuJtAsDRH1oA/GyBtYJAi6Db4xhEAdoXDFska1F3lnS8PyR9hWn3AjlEsmKuI801FnAdu/Qthlw/D2zPm6gAAAABJRU5ErkJggg=="},159:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA80lEQVQ4jYXTTWrDMBCG4UfClJ7KJ+jPwg0kiy5KjlWy6iKBNF2kOUGOFQLpIhOQY9kdMAhp3m/k0TcJdsdLg0/8dm36MRG74+UNz1h2bTqngL8wxxmLrk3fE/AaDTZ4z1F5HjkN1pE4BQtmlbHDqcgdiFRgwWxTJDyF0EORcMYi1jW469p0SEWVMRFjMKTiYEykjB48EPhHZABDrlR5HNnPcdaL+1+odbuMgU/KJtbgWhN7InkCPmEW36hP0hTctWkfBV6wVfFJdh2M2jvvbxux7io3ec1Yug5GCfeeKkQOdyIbfNys3GCFbQ0uI3wyE+P8BxCxer8sEjnMAAAAAElFTkSuQmCC"},160:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAADJklEQVRoge2Zz04UQRDGf+CyBNiorEIiIAcvHD2AoMhFfANDCA8AyBsQTbihXDVifAONnowaj/gAamKCB5VoohJYBS+A7noRDzUkQ03P7vR074Jxv6QTeun+6que/lNdDXXU8X+jwRNPIzAIjAL9QB/QBeSC/+8Aa8A74DWwBLwE/niynxo9wAKwCuxalq/ATaC75qqBE8A94HdCseVKCbgL5GslfgLY9CBclw1gvJrCM8ioxwnYAu4DU8A5oANoCkoHskamgAdB2ziexcCWV7QAT2MMrgEzQKsFXyswCazEcD4JbHpBBrP4EjAHtDlwNwGzAZfJCS9fwjRt1oELPsgDDAMFg507rsQTBtJl4LQrsQG9Abe2N5aWMI/sDGGyAtURv4deol9iE9m2raGnThG/0yYOF4muCeup1EP0kJrzp7EirinbJSQ0SYwFRbCG/W6j57INssBH1f9G0s5HiMY2M5YCwM0BgGnV/zMSNFbEedVxC7tDag+uDrQB24pjUDcyeTSq6s+AXykEuOIn8Fz9dkk3MjnQr+ovfClKgSVVH9ANTA70qfobb3LsoW1rbUb8YP+8O1mhvWsYXQ6dqu1GEgf0/p89QAeaVduSbpBoWzrMMDmwo+pHayEkBsdUfVs3MDmwrupnKhhpiClp25WzrbUZHXiv6mcrGKkmtG2tzejAK1XXB1stcVnVtTYjhjgcoUQOWY9hjshBZkIjknQKd5xMIeDAgjmQjFm48wpyAbeBiwPNwCfVf96GoJvorWjWUoQLrivbRSwvNCDpPn0KDvvTGIsRotHA7TREeeC7IiogF+9qwXSp/wa0pyUcJzqXl6mOE73AW4O9K67EiwbSApI98IURZKS1nVs+yDNImk+Tl5DsQaVotRyyyII1pekfI/dzL2jB7MQukj2Yxi5rkQv66K0yLN5bcncPGSTBFBfXbwMPgavIad6JjHA2+HsIyW48InrC6h3H28ibMIZ5vrqWAh4WbFK0I1/DlBa3LUVk1I/XSnwYXUjG7EtCsTq2mQdOuQjw+cw6wP5n1m72P7OuAh+QkHgJeW498GfWOur41/EXIXDHx54QfycAAAAASUVORK5CYII="},169:function(e,t,a){e.exports=a(255)},174:function(e,t,a){},175:function(e,t,a){e.exports=a.p+"static/media/logo.25bf045c.svg"},178:function(e,t,a){!function(a){"use strict";var n=0,r=void 0;function s(e){return function(e){return"function"===typeof e}(e)?e():e}var o=Object.prototype.toString;function i(e,t){if(!(this instanceof i))return new i(e,t);var a=t.canvas||{};this._audioEnded=null,this._paused=null,this._pausedAt=null,this._startedAt=null,this._sources={audioBufferStream:null,userMediaStream:null},this._baseCanvas=e,this._baseCanvasContext=this._baseCanvas.getContext("2d"),this._baseCanvas.width=s(a.width)||this._baseCanvas.width,this._baseCanvas.height=s(a.height)||this._baseCanvas.height,window.onresize=function(){this._baseCanvas.width=s(a.width)||this._baseCanvas.width,this._baseCanvas.height=s(a.height)||this._baseCanvas.height}.bind(this);var n=t.audio||{};this.audio=n;var r=[];r="function"===typeof t.colors?t.colors(275):this._generateDefaultColors(275),this._colors=r,this._baseCanvasContext.fillStyle=this._getColor(0),this._baseCanvasContext.fillRect(0,0,this._baseCanvas.width,this._baseCanvas.height)}i.prototype._init=function(){var e=this._sources.audioBufferStream;e.scriptNode=e.audioContext.createScriptProcessor(2048,1,1),e.scriptNode.connect(e.audioContext.destination),e.scriptNode.onaudioprocess=function(t){var a=new Uint8Array(e.analyser.frequencyBinCount);e.analyser.getByteFrequencyData(a),this._draw(a,e.canvasContext)}.bind(this),e.sourceNode.onended=function(){this.clear()}.bind(this),e.analyser=e.audioContext.createAnalyser(),e.analyser.smoothingTimeConstant=0,e.analyser.fftSize=4096,e.analyser.connect(e.scriptNode),e.sourceNode.connect(e.analyser),this.audio.enable&&e.sourceNode.connect(e.audioContext.destination)},i.prototype._draw=function(e,t){if(console.log(n),this._paused)return!1;var a=t.canvas,r=a.width,s=a.height,o=t._tempContext,i=o.canvas;o.drawImage(a,0,0,r,s);for(var c=0;c<e.length;c++){var l=e[c];t.fillStyle=this._getColor(l),this._audioEnded&&(t.fillStyle=this._getColor(0)),t.fillRect(n,s-c,1,1)}t.drawImage(i,0,0,r,s,0,0,r,s),t.drawImage(i,0,0,r,s,0,0,r,s),t.setTransform(1,0,0,1,0,0),this._baseCanvasContext.drawImage(a,0,0,r,s),this._audioEnded||(n+=1)},i.prototype._startMediaStreamDraw=function(e,t){window.requestAnimationFrame(this._startMediaStreamDraw.bind(this,e,t));var a=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(a),this._draw(a,t)},i.prototype.connectSource=function(e,t){var a=this._sources.audioBufferStream||{};if("[object ScriptProcessorNode]"===o.call(a.scriptNode)&&(a.scriptNode.onaudioprocess=null),"[object AudioBuffer]"===o.call(e)){var n=(t=!t&&a.audioBuffer.context||!t&&a.audioContext||t).createBufferSource();n.buffer=e;var r=a.canvasContext;if(!a.canvasContext){var s=document.createElement("canvas");s.width=this._baseCanvas.width,s.height=this._baseCanvas.height,r=s.getContext("2d");var i=document.createElement("canvas");i.width=s.width,i.height=s.height,r._tempContext=i.getContext("2d")}a={audioBuffer:e,audioContext:t,sourceNode:n,analyser:null,scriptNode:null,canvasContext:r},this._sources.audioBufferStream=a,this._init()}"[object AnalyserNode]"===o.call(e)&&((a=this._sources.userMediaStream||{}).analyser=e,this._sources.userMediaStream=a)},i.prototype.start=function(e,t){r=t;var a=this._sources.audioBufferStream,n=this._sources.userMediaStream;if(a&&a.sourceNode&&(a.sourceNode.start(0,e||0),this._audioEnded=!1,this._paused=!1,this._startedAt=Date.now()),n&&n.analyser){a=n;var s=document.createElement("canvas");s.width=this._baseCanvas.width,s.height=this._baseCanvas.height;var o=s.getContext("2d"),i=document.createElement("canvas");i.width=s.width,i.height=s.height,o._tempContext=i.getContext("2d"),this._startMediaStreamDraw(a.analyser,o)}},i.prototype.stop=function(){var e=this._sources[Object.keys(this._sources)[0]];e&&e.sourceNode&&e.sourceNode.stop(),n=0,this._audioEnded=!0,r()},i.prototype.pause=function(){this.stop(),this._paused=!0,this._pausedAt+=Date.now()-this._startedAt},i.prototype.resume=function(e){var t=this._sources[Object.keys(this._sources)[0]];this._paused=!1,this._pausedAt&&(this.connectSource(t.audioBuffer,t.audioContext),this.start(e||this._pausedAt/1e3))},i.prototype.clear=function(e){var t=this._sources[Object.keys(this._sources)[0]];this.stop(),"[object ScriptProcessorNode]"===o.call(t.scriptNode)&&(t.scriptNode.onaudioprocess=null)},i.prototype._generateDefaultColors=function(e){var t=Math.PI/e,a=Math.PI/2*3.1,n=[];function r(e){return"rgba("+[e,e,e,1].toString()+")"}for(var s=0;s<e;s++){var o=127*Math.sin(t*s+a)+128>>0;n.push(r(o))}return n},i.prototype._getColor=function(e){var t=this._colors[e>>0];return"undefined"===typeof t&&(t=this._colors[0]),t},e.exports&&(t=e.exports=i),t.Spectrogram=i}()},202:function(e,t){},203:function(e,t){},204:function(e,t){},205:function(e,t){},206:function(e,t){},207:function(e,t){},210:function(e,t){},212:function(e,t){},253:function(e,t,a){e.exports=a.p+"static/media/DJB.e4210c98.ttf"},254:function(e,t,a){e.exports=a.p+"static/media/Poppins-Regular.de2dd933.otf"},255:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(11),o=a.n(s),i=(a(174),a(175),a(54),a(30)),c=a(31),l=a(35),u=a(32),m=a(34),d=a(6),p=a.n(d),h=a(12),g=a(15),f=(a(177),a(178),a(102)),b=a(25),v=a(154),y=a(63),A=a(47),E=a(153),w=a.n(E),j=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).decrement=function(){a.setState({countdown:a.state.countdown-1},(function(){0===a.state.countdown?(a.stopRecording(),a.setState({countdown:a.maxAudioTime})):a.timer()}))},a.timer=function(){setTimeout(a.decrement,1e3)},a.startRecording=function(){a.setState({record:!0}),a.recordInterval=setInterval((function(){a.setState({recordProgress:a.state.recordProgress+20/a.maxAudioTime})}),50),a.timer()},a.stopRecording=function(){a.setState({record:!1,recordProgress:0}),clearInterval(a.recordInterval)},a.onStop=function(e){console.log("recordedBlob is: ",e),console.log("recordedBlob.blob is: ",e.blob),a.getSpectrogram(e).then((function(e){e.onload=function(){var t=e.result;a.props.handleNewImage(t,a.state.currentLabel)}}))},a.getSpectrogram=function(){var e=Object(h.a)(p.a.mark((function e(t){var a,n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("AUDIO BLOB:"),console.log(t),e.next=4,fetch("https://c1.appinventor.mit.edu:5000/spectrogram",{method:"POST",body:t.blob});case 4:return a=e.sent,e.next=7,a.blob();case 7:return n=e.sent,(r=new FileReader).readAsDataURL(n),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.recordInterval=void 0,a.maxAudioTime=1,a.startRecording=a.startRecording.bind(Object(g.a)(a)),a.stopRecording=a.stopRecording.bind(Object(g.a)(a)),a.onStop=a.onStop.bind(Object(g.a)(a)),a.decrement=a.decrement.bind(Object(g.a)(a)),a.timer=a.timer.bind(Object(g.a)(a)),a.getSpectrogram=a.getSpectrogram.bind(Object(g.a)(a)),a.formatRecordButtonText=a.formatRecordButtonText.bind(Object(g.a)(a)),a.state={record:!1,recordProgress:0,countdown:a.maxAudioTime,allLabels:a.props.allLabels,currentLabel:0===a.props.allLabels.length?void 0:a.props.allLabels[0]},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({allLabels:e.allLabels}),void 0===this.state.currentLabel&&this.setState({currentLabel:e.allLabels[0]})}},{key:"formatRecordButtonText",value:function(){if(this.state.record)return r.a.createElement("img",{src:w.a,width:10,height:10})}},{key:"handleDropdownSelect",value:function(e){this.setState({currentLabel:e})}},{key:"render",value:function(){var e=this;return console.log(this.state.recordProgress),r.a.createElement("div",{className:"record-box"},r.a.createElement("div",{className:"recording-for-dropdown-wrapper"},r.a.createElement("a",{className:"record-p"},"RECORDING FOR: \xa0"),r.a.createElement(v.a,{disabled:0===this.state.allLabels.length,title:0===this.state.allLabels.length?"No Labels":this.state.currentLabel,size:"sm",variant:"outline-light"},this.state.allLabels.map((function(t){return r.a.createElement(y.a.Item,{key:t,onClick:function(){return e.handleDropdownSelect(t)}},t)})))),r.a.createElement(f.a,{record:this.state.record,className:"sound-wave",onStop:this.onStop,strokeColor:"#adc2ff",backgroundColor:"#1a1a1d",width:200,height:140}),r.a.createElement("div",{className:"record-and-countdown"},r.a.createElement(b.a,{onClick:this.startRecording,disabled:0===this.state.allLabels.length,variant:this.state.record?"outline-danger":"outline-light",className:"record-button"},"Record")),r.a.createElement(A.a,{animated:!0,variant:"danger",style:{width:100,borderRadius:3,backgroundColor:"#e9ecef",visibility:0==this.state.recordProgress?"hidden":"visible"},now:this.state.recordProgress}))}}]),t}(r.a.Component),k=a(159),C=a.n(k),O=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={images:a.props.images,name:a.props.name},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({images:e.images})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"label-border scale-in-center"},r.a.createElement("div",{className:"label-box"},r.a.createElement("div",{className:"title-box"},r.a.createElement("p",{className:"name-p"},this.state.name),r.a.createElement("p",{className:"count-p"},this.state.images.length+(1===this.state.images.length?" example":" examples"))),r.a.createElement("div",{className:"vertical-line"},r.a.createElement("img",{src:C.a,width:10,style:{margin:"auto",cursor:"pointer"},onClick:function(){return e.props.handleRemoveLabel(e.state.name)}})),r.a.createElement("div",{className:"image-box"},this.state.images.map((function(t){return r.a.createElement("div",{id:"image-wrapper",key:t},r.a.createElement("img",{src:t,className:"image hover"}),r.a.createElement("p",{className:"text",onClick:function(){return e.props.handleRemoveImage(t,e.state.name)}},"x"))})))))}}]),t}(r.a.Component),M=a(168),x=a(53),N=a(50),S=a(20),I=a(81),R=a(64),_=a(51),B=a(160),D=a.n(B),L=a(29),T=a(41),P=a(62);function Q(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function F(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Q(a,!0).forEach((function(t){Object(N.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Q(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var G=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleNewImage=a.handleNewImage.bind(Object(g.a)(a)),a.handleRemoveImage=a.handleRemoveImage.bind(Object(g.a)(a)),a.handleRemoveLabel=a.handleRemoveLabel.bind(Object(g.a)(a)),a.handleLabelKeyDown=a.handleLabelKeyDown.bind(Object(g.a)(a)),a.createNewLabel=a.createNewLabel.bind(Object(g.a)(a)),a.tuneModal=a.tuneModal.bind(Object(g.a)(a)),a.state={imageMap:void 0===a.props.location.state?{}:a.props.location.state.imageMap},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"downloadURI",value:function(e,t){var a=document.createElement("a");a.download=t,a.href=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}},{key:"handleNewImage",value:function(e,t){this.setState({imageMap:F({},this.state.imageMap,Object(N.a)({},t,[].concat(Object(x.a)(this.state.imageMap[t]),[e])))})}},{key:"handleRemoveLabel",value:function(e){var t=this,a={};Object.keys(this.state.imageMap).forEach((function(n){e!==n&&(a[n]=t.state.imageMap[n])})),this.setState({imageMap:a})}},{key:"handleRemoveImage",value:function(e,t){var a=Object(x.a)(this.state.imageMap[t]),n=a.indexOf(e);-1!==n&&(a.splice(n,1),this.setState({imageMap:F({},this.state.imageMap,Object(N.a)({},t,a))}))}},{key:"handleLabelKeyDown",value:function(e){13===e.keyCode&&(this.createNewLabel(e.target.value),document.body.click())}},{key:"createNewLabel",value:function(e){this.setState({imageMap:F({},this.state.imageMap,Object(N.a)({},e,[]))})}},{key:"tuneModal",value:function(){var e=this,t=Object(n.useState)(!1),a=Object(M.a)(t,2),s=a[0],o=a[1],i=function(){return o(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a,{variant:"dark",size:"sm",className:"train-button",onClick:function(){return o(!0)},disabled:!(Object.keys(this.state.imageMap).length>0&&Math.min.apply(Math,Object(x.a)(Object.keys(this.state.imageMap).map((function(t){return e.state.imageMap[t].length}))))>1)},"Train"),r.a.createElement(R.a,{show:s,onHide:i,centered:!0},r.a.createElement(R.a.Header,{closeButton:!0},r.a.createElement(R.a.Title,null,"Customize Hyperparameters")),r.a.createElement(R.a.Body,null),r.a.createElement(S.a,null,r.a.createElement(S.a.Group,{controlId:"exampleForm.ControlInput1"},r.a.createElement(S.a.Label,null,"Learning Rate"),r.a.createElement(S.a.Control,{type:"number",defaultValue:"0.0001",step:".0001"})),r.a.createElement(S.a.Group,{controlId:"exampleForm.ControlSelect1"},r.a.createElement(S.a.Label,null,"Optimizer"),r.a.createElement(S.a.Control,{as:"select"},r.a.createElement("option",null,"Adam"),r.a.createElement("option",null,"SGD"),r.a.createElement("option",null,"Adagrad"),r.a.createElement("option",null,"Adadelta"))),r.a.createElement(S.a.Group,{controlId:"exampleForm.ControlInput2"},r.a.createElement(S.a.Label,null,"Epochs"),r.a.createElement(S.a.Control,{type:"number",defaultValue:"20",step:"1"})),r.a.createElement(S.a.Group,{controlId:"exampleForm.ControlInput2"},r.a.createElement(S.a.Label,null,"Training Data Fraction"),r.a.createElement(S.a.Control,{type:"number",defaultValue:".4",step:".1"}))),r.a.createElement(R.a.Footer,null,r.a.createElement(b.a,{variant:"danger",onClick:i},"Close"),r.a.createElement(L.b,{to:{pathname:"/test",state:{imageMap:this.state.imageMap}}},r.a.createElement(b.a,{variant:"warning"},"  Train Model ")))))}},{key:"render",value:function(){var e=this;return console.log(this.state.imageMap),r.a.createElement("header",{className:"App-header"},r.a.createElement(T.a,{bg:"dark",variant:"dark"},r.a.createElement(T.a.Brand,{href:"/"},"Personal Audio Classifier"),r.a.createElement(P.a,{className:"mr-auto"},r.a.createElement(L.b,{to:{pathname:"/",state:{imageMap:this.state.imageMap}}},"Train"),r.a.createElement(L.b,{to:{pathname:"/test",state:{imageMap:this.state.imageMap}},className:Object.keys(this.state.imageMap).length>0&&Math.min.apply(Math,Object(x.a)(Object.keys(this.state.imageMap).map((function(t){return e.state.imageMap[t].length}))))>1?"":"disable-link"},"Test"))),r.a.createElement("div",{className:"view-all"},r.a.createElement(j,{handleNewImage:this.handleNewImage,allLabels:Object.keys(this.state.imageMap)}),r.a.createElement("div",{className:"all-labels"},r.a.createElement("div",{className:"plus-wrapper"},r.a.createElement(I.a,{trigger:"click",placement:"right",rootClose:!0,overlay:r.a.createElement(_.a,null,r.a.createElement(_.a.Title,{as:"h3"},"Create New Label"),r.a.createElement(_.a.Content,null,r.a.createElement("input",{type:"text",name:"name",autoFocus:!0,onKeyDown:this.handleLabelKeyDown})))},r.a.createElement("img",{src:D.a,className:"plus"})),Object.keys(this.state.imageMap).length>0&&r.a.createElement(this.tuneModal,null)),Object.keys(this.state.imageMap).map((function(t){return r.a.createElement(O,{name:t,images:e.state.imageMap[t],handleRemoveImage:e.handleRemoveImage,handleRemoveLabel:e.handleRemoveLabel,key:t})})))),r.a.createElement("div",null))}}]),t}(r.a.Component),W=a(8),K=(r.a.Component,a(48)),V=a(164),z=a(165),U=a(166),J=a(167),X=a(83);a(244);function H(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?H(a,!0).forEach((function(t){Object(N.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):H(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var q=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).canvasRef=r.a.createRef(),a.handleTestImage=a.handleTestImage.bind(Object(g.a)(a)),a.exportModel=a.exportModel.bind(Object(g.a)(a)),a.state={imageMap:a.props.location.state.imageMap,transferModel:void 0,customModel:void 0,trainActivations:void 0,testImage:void 0,testRanks:void 0,testConfidences:void 0,testResults:void 0,loading:!0,progress:0,message:"Loading..."},a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(h.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.train();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTransferModel",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(W.j.tfjs),console.log("Loading mobilenet.."),this.setState({message:"Loading mobilenet...",progress:20}),e.next=5,W.c("https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json");case 5:return t=e.sent,console.log("Successfully loaded model"),a=t.getLayer("conv_pw_13_relu"),n=W.d({inputs:t.inputs,outputs:a.output,name:"modelModified"}),console.log("Mobilenet model is modified"),this.setState({message:"Truncating mobilenet...",progress:50}),n.summary(),e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getImg",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var a,n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){return new Promise((function(e,a){var n=new Image;n.onload=function(){e({img:n})},n.src=t,n.width=200,n.height=200}))},e.next=3,a();case 3:return n=e.sent,r=n.img,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertImg",value:function(){var e=Object(h.a)(p.a.mark((function e(t){var a,n,r,s,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){return new Promise((function(e,a){var n=new Image;n.onload=function(){e({img:n})},n.src=t,n.width=200,n.height=200}))},e.next=3,a();case 3:return n=e.sent,r=n.img,s=W.a.fromPixels(r).resizeNearestNeighbor([224,224]),o=s.toFloat().div(W.e(127)).sub(W.e(1)),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"train",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a,n,r,s,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransferModel();case 2:return t=e.sent,(a=this.getCustomModel()).summary(),e.next=7,this.generateInputTensors();case 7:return n=e.sent,r=n.images,s=n.labels,o=this.generateActivations(r,t),i={},Object.keys(this.state.imageMap).sort().forEach((function(e){i[e]=[]})),this.setState({trainActivations:o,customModel:a,transferModel:t,testResults:i}),e.next=16,this.fitCustomModel(o,s,a);case 16:console.log("done"),this.setState({loading:!1});case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fitCustomModel",value:function(){var e=Object(h.a)(p.a.mark((function e(t,a,n){var r,s=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Math.floor(.4*t.shape[0]),e.prev=1,e.next=4,n.fit(t,a,{batchSize:r,epochs:20,callbacks:{onBatchEnd:function(){var e=Object(h.a)(p.a.mark((function e(t,a){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loss: "+a.loss.toFixed(5)),s.setState({message:"Training model... loss: "+a.loss.toFixed(5),progress:s.state.progress+3});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"generateActivations",value:function(e,t){var a=[];return W.i(e).forEach((function(e){var n=t.predict(W.g([e]));a.push(W.i(n)[0])})),W.g(a)}},{key:"getCustomModel",value:function(){console.log("Building the model..."),this.setState({message:"Building custom model...",progress:70});var e=W.f();return e.add(W.b.conv2d({inputShape:[7,7,256],kernelSize:5,filters:5,strides:1,activation:"relu",kernelInitializer:"varianceScaling"})),e.add(W.b.flatten()),e.add(W.b.dense({units:100,kernelInitializer:"varianceScaling",useBias:!0,activation:"relu"})),e.add(W.b.dense({kernelInitializer:"varianceScaling",units:Object.keys(this.state.imageMap).length,useBias:!1,activation:"softmax"})),e.compile({optimizer:W.h.adam(1e-4),loss:"categoricalCrossentropy"}),e}},{key:"generateInputTensors",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a,n,r,s,o,i,c,l,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in t=[],a=[],n={},this.state.imageMap)n[r]=[];e.t0=p.a.keys(this.state.imageMap);case 5:if((e.t1=e.t0()).done){e.next=18;break}s=e.t1.value,e.t2=p.a.keys(this.state.imageMap[s]);case 8:if((e.t3=e.t2()).done){e.next=16;break}return o=e.t3.value,e.next=12,this.convertImg(this.state.imageMap[s][o]);case 12:i=e.sent,n[s].push(i),e.next=8;break;case 16:e.next=5;break;case 18:return(c=Object.keys(n).sort()).forEach((function(e){console.log(e),n[e].forEach((function(n){t.push(n);var r=[];c.forEach((function(t){r.push(t===e?1:0)})),console.log(r),a.push(r)}))})),l=W.g(t),u=W.g(a),e.abrupt("return",{images:l,labels:u});case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"exportModel",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={save:function(e){var t=new Blob([e.weightData],{type:"application/octet-stream"}),n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,weightsManifest:n},s=new Blob([JSON.stringify(r)],{type:"application/json"}),o=new V;o.file("model.json",s),o.file("model.weights.bin",t);var i={};Object.keys(a.state.imageMap).sort().forEach((function(e,t){i[t]=e})),console.log(JSON.stringify(i)),o.file("model_labels.json",JSON.stringify(i)),o.file("transfer_model.json",'{"name":"mobilenet","lastLayer":"conv_pw_13_relu","url":"https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json"}'),o.generateAsync({type:"blob"}).then((function(e){z.saveAs(e,"model.mdl")}))}},e.next=3,this.state.customModel.save(t);case 3:e.sent;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleTestImage",value:function(e){var t=this;console.log("image changed"),this.setState({testImage:e},Object(h.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.test();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))))}},{key:"test",value:function(){var e=Object(h.a)(p.a.mark((function e(){var t,a,n,r,s,o,i,c,l,u,m=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.transferModel,a=this.state.customModel,e.next=4,this.convertImg(this.state.testImage);case 4:return n=e.sent,r=t.predict(W.g([n])),s=a.predict(r),e.next=9,s.topk(Object.keys(this.state.imageMap).length);case 9:return o=e.sent,e.next=12,o.values.data();case 12:return i=e.sent,e.next=15,o.indices.data();case 15:c=e.sent,console.log(i),console.log(c),l={},u={},Object.keys(this.state.imageMap).sort().forEach((function(e,t){var a=c.indexOf(t);0==a&&m.setState({testResults:Y({},m.state.testResults,Object(N.a)({},e,[].concat(Object(x.a)(m.state.testResults[e]),[[m.state.testImage,i[a]]])))}),l[e]=a,u[e]=i[a]})),console.log(l),this.setState({testRanks:l,testConfidences:u});case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return console.log(this.state),this.state.loading?r.a.createElement("header",{className:"App-header"},r.a.createElement(T.a,{bg:"dark",variant:"dark"},r.a.createElement(T.a.Brand,{href:"/"},"Personal Audio Classifier"),r.a.createElement(P.a,{className:"mr-auto"},r.a.createElement(L.b,{to:{pathname:"/",state:{imageMap:this.state.imageMap}}},"Train"),r.a.createElement(L.b,{to:{pathname:"/test",state:{imageMap:this.state.imageMap}}},"Test"))),r.a.createElement("div",{className:"loading"},r.a.createElement("p",{className:"message"},this.state.message),r.a.createElement(A.a,{animated:!0,variant:"warning",style:{width:"500px"},now:this.state.progress})),r.a.createElement("div",null)):r.a.createElement("div",null,r.a.createElement("header",{className:"App-header"},r.a.createElement(T.a,{bg:"dark",variant:"dark"},r.a.createElement(T.a.Brand,{href:"/"},"Personal Audio Classifier"),r.a.createElement(P.a,{className:"mr-auto"},r.a.createElement(L.b,{to:{pathname:"/",state:{imageMap:this.state.imageMap}}},"Train"),r.a.createElement(L.b,{to:{pathname:"/test",state:{imageMap:this.state.imageMap}}},"Test"))),r.a.createElement("div",null,r.a.createElement("div",{className:"view-all"},r.a.createElement(j,{handleNewImage:this.handleTestImage,allLabels:Object.keys(this.state.imageMap)}),r.a.createElement("div",{className:"test-pic-background"},r.a.createElement("p",{className:"test-pic-p"},"SPECTROGRAM:"),r.a.createElement("img",{src:this.state.testImage,className:"test-pic hover"})),r.a.createElement("div",{className:"results-background"},r.a.createElement("p",{className:"classification-p"},"CLASSIFICATION:"),Object.keys(this.state.imageMap).sort().map((function(t,a,n){return void 0!==e.state.testRanks?r.a.createElement("div",{className:"results-bubble",key:t},r.a.createElement(I.a,{trigger:"hover",placement:"right",overlay:r.a.createElement(_.a,null,r.a.createElement(_.a.Title,{as:"h3"},"Details"),r.a.createElement(_.a.Content,null,r.a.createElement("strong",null,"Confidence: ",Math.round(1e4*e.state.testConfidences[t])/100,"%    "),r.a.createElement("div",{style:{marginTop:"5px"}}),r.a.createElement(A.a,{now:Math.round(1e4*e.state.testConfidences[t])/100,variant:0===e.state.testRanks[t]?"success":"danger"})))},r.a.createElement(X.a,{variant:void 0===e.state.testRanks?"info":0===e.state.testRanks[t]?"success":"danger"},r.a.createElement("p",{align:"center",className:"results-bubble-title"},t)))):r.a.createElement("div",{className:"results-bubble",key:t},r.a.createElement(X.a,{variant:void 0===e.state.testRanks?"info":0===e.state.testRanks[t]?"success":"danger"},r.a.createElement("p",{align:"center",className:"results-bubble-title"},t)))})))),r.a.createElement(b.a,{variant:"dark",className:"train-button",onClick:this.exportModel},"Export")),r.a.createElement("div",null)),r.a.createElement(U.a,{fluid:!0},r.a.createElement(J.a,null,r.a.createElement("h1",null,"Test Results"),r.a.createElement("p",null),void 0!==this.state.testResults&&Object.keys(this.state.testResults).sort().map((function(t){var a=e.state.testResults[t];return r.a.createElement("div",{className:"results-row",key:t},r.a.createElement("div",{className:"test-label-bubble",key:t},r.a.createElement(X.a,{variant:"info"},r.a.createElement("p",{align:"center",className:"results-bubble-title"},t))),r.a.createElement("div",{className:"results-cells-wrapper"},a.map((function(e){var t=e[0],a=e[1];return r.a.createElement("div",{className:"results-cell",key:e},r.a.createElement("img",{src:t,width:100,className:"results-cell-pic"}),r.a.createElement(A.a,{now:Math.round(100*a),label:Math.round(100*a)+"%"}))}))))})))))}}]),t}(r.a.Component);var Z=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(L.a,null,r.a.createElement(K.a,{exact:!0,path:"/",component:G}),r.a.createElement(K.a,{path:"/test",component:q})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(252),a(253),a(254);o.a.render(r.a.createElement(Z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},54:function(e,t,a){}},[[169,1,2]]]);
//# sourceMappingURL=main.1de1af6f.chunk.js.map
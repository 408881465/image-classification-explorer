{"version":3,"sources":["images/red_circle.png","images/arrow.png","images/plus.png","logo.svg","spectrogram/spectrogram.js","fonts/DJB.ttf","fonts/Poppins-Regular.otf","Audio.js","Label.js","LabelView.js","Loading.js","TestView.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","root","slide","resolveFunction","undefined","_result","v","_isFunction","toString","Object","prototype","Spectrogram","canvas","options","this","baseCanvasOptions","_audioEnded","_paused","_pausedAt","_startedAt","_sources","audioBufferStream","userMediaStream","_baseCanvas","_baseCanvasContext","getContext","width","height","window","onresize","bind","audioOptions","audio","colors","_generateDefaultColors","_colors","fillStyle","_getColor","fillRect","_init","source","scriptNode","audioContext","createScriptProcessor","connect","destination","onaudioprocess","event","array","Uint8Array","analyser","frequencyBinCount","getByteFrequencyData","_draw","canvasContext","sourceNode","onended","clear","createAnalyser","smoothingTimeConstant","fftSize","enable","console","log","tempCanvasContext","_tempContext","tempCanvas","drawImage","i","length","value","setTransform","_startMediaStreamDraw","requestAnimationFrame","audioData","connectSource","audioBuffer","call","context","createBufferSource","buffer","document","createElement","start","offset","resolve","sourceMedia","Date","now","stop","keys","pause","resume","steps","frequency","Math","PI","slice","toRGBString","sin","push","index","color","Audio","props","decrement","setState","countdown","state","stopRecording","maxAudioTime","timer","setTimeout","startRecording","record","onStop","recordedBlob","blob","getSpectrogram","then","reader","onload","result","handleNewImage","currentLabel","a","fetch","method","body","response","FileReader","readAsDataURL","formatRecordButtonText","allLabels","nextProps","src","redCircle","selectedLabel","className","DropdownButton","disabled","title","size","variant","map","l","Dropdown","Item","key","onClick","handleDropdownSelect","strokeColor","backgroundColor","Button","React","Component","Label","images","name","arrow","style","margin","id","handleRemoveImage","LabelView","handleLabelKeyDown","createNewLabel","tuneModal","imageMap","location","uri","link","download","href","appendChild","click","removeChild","image","indexOf","splice","e","keyCode","target","labelName","useState","show","setShow","handleClose","min","k","Modal","onHide","centered","Header","closeButton","Title","Body","Form","Group","controlId","Control","type","defaultValue","step","as","Footer","to","pathname","Navbar","bg","Brand","Nav","OverlayTrigger","trigger","placement","rootClose","overlay","Popover","Content","autoFocus","onKeyDown","plus","TestView","canvasRef","createRef","handleTestImage","exportModel","transferModel","customModel","trainActivations","testImage","testRanks","testConfidences","testResults","loading","progress","message","train","tf","tfjs","model","layer","getLayer","modelModified","inputs","outputs","output","summary","imgUrl","load","Promise","reject","img","Image","trainImage","fromPixels","resizeNearestNeighbor","trainImageNormalized","toFloat","div","sub","getTransferModel","getCustomModel","generateInputTensors","labels","activations","generateActivations","sort","forEach","fitCustomModel","batchSize","floor","shape","fit","epochs","callbacks","onBatchEnd","batch","logs","loss","toFixed","activation","predict","add","conv2d","inputShape","kernelSize","filters","strides","kernelInitializer","flatten","dense","units","useBias","compile","optimizer","adam","label","imageTensors","labelTensors","imageMapConverted","imgIndex","convertImg","convertedImg","tensor","labelTensor","zipSaver","save","modelSpecs","weightsBlob","Blob","weightData","weightsManifest","paths","weights","weightSpecs","modelTopologyAndWeightManifest","modelTopology","modelTopologyAndWeightManifestBlob","JSON","stringify","zip","JSZip","file","generateAsync","FileSaver","test","prediction","topk","top","values","data","confidences","indices","ranks","rank","ProgressBar","animated","arr","round","marginTop","Alert","align","Jumbotron","fluid","Container","results","r","confidence","App","exact","path","component","Boolean","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.c5514a2c.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAvklEQVQ4jaWTMQrCQBBFn0sKT+ABRFKIiHey8iQiwcJCxFN4ADGtpYWVXQobSxFsRL7NhpjVjWaz8Lt5f2d254NzBLEgERwEV6ujYCHou/XvYCSYCR4CefQULAXtb/CmAnS1LZkIpjXgXOsc7v1ou2qcoQHGQOR9HP8xwATBPuD2XKeW4AJ0AjoAuJtAsDRH1oA/GyBtYJAi6Db4xhEAdoXDFska1F3lnS8PyR9hWn3AjlEsmKuI801FnAdu/Qthlw/D2zPm6gAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAQlBMVEUAAACsw/+twv+twv+qv/+twv+twf+uw/+ZzP+twv+twv+uwf+q1f+twv+vxf+twv+swv+twv+swf+twv+twv8AAAADA4KZAAAAFHRSTlMATevNJMjkkAWv5ykGsSO1sOORzKS9YgMAAAABYktHRACIBR1IAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH4woFEQ8Itc12pQAAAElJREFUKM9jYAABRiZmFgZsgFVEhA2rDLsIDhkOTqAMF/cAyvCQI8ML8g8fLhl+EiRwGcUjABQXZBn04gxCuKIWZ2JgZBJGFwcAurcIgxaq/UMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTAtMDVUMTc6MTU6MDgrMDA6MDA/GEaSAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTEwLTA1VDE3OjE1OjA4KzAwOjAwTkX+LgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAADJklEQVRoge2Zz04UQRDGf+CyBNiorEIiIAcvHD2AoMhFfANDCA8AyBsQTbihXDVifAONnowaj/gAamKCB5VoohJYBS+A7noRDzUkQ03P7vR074Jxv6QTeun+6que/lNdDXXU8X+jwRNPIzAIjAL9QB/QBeSC/+8Aa8A74DWwBLwE/niynxo9wAKwCuxalq/ATaC75qqBE8A94HdCseVKCbgL5GslfgLY9CBclw1gvJrCM8ioxwnYAu4DU8A5oANoCkoHskamgAdB2ziexcCWV7QAT2MMrgEzQKsFXyswCazEcD4JbHpBBrP4EjAHtDlwNwGzAZfJCS9fwjRt1oELPsgDDAMFg507rsQTBtJl4LQrsQG9Abe2N5aWMI/sDGGyAtURv4deol9iE9m2raGnThG/0yYOF4muCeup1EP0kJrzp7EirinbJSQ0SYwFRbCG/W6j57INssBH1f9G0s5HiMY2M5YCwM0BgGnV/zMSNFbEedVxC7tDag+uDrQB24pjUDcyeTSq6s+AXykEuOIn8Fz9dkk3MjnQr+ovfClKgSVVH9ANTA70qfobb3LsoW1rbUb8YP+8O1mhvWsYXQ6dqu1GEgf0/p89QAeaVduSbpBoWzrMMDmwo+pHayEkBsdUfVs3MDmwrupnKhhpiClp25WzrbUZHXiv6mcrGKkmtG2tzejAK1XXB1stcVnVtTYjhjgcoUQOWY9hjshBZkIjknQKd5xMIeDAgjmQjFm48wpyAbeBiwPNwCfVf96GoJvorWjWUoQLrivbRSwvNCDpPn0KDvvTGIsRotHA7TREeeC7IiogF+9qwXSp/wa0pyUcJzqXl6mOE73AW4O9K67EiwbSApI98IURZKS1nVs+yDNImk+Tl5DsQaVotRyyyII1pekfI/dzL2jB7MQukj2Yxi5rkQv66K0yLN5bcncPGSTBFBfXbwMPgavIad6JjHA2+HsIyW48InrC6h3H28ibMIZ5vrqWAh4WbFK0I1/DlBa3LUVk1I/XSnwYXUjG7EtCsTq2mQdOuQjw+cw6wP5n1m72P7OuAh+QkHgJeW498GfWOur41/EXIXDHx54QfycAAAAASUVORK5CYII=\"","module.exports = __webpack_public_path__ + \"static/media/logo.25bf045c.svg\";","(function(root) {\n  'use strict';\n  var slide = 0;\n  var resolveFunction = undefined;\n\n  function _isFunction(v) {\n    return typeof v === 'function';\n  }\n\n  function _result(v) {\n    return _isFunction(v) ? v() : v;\n  }\n\n  var toString = Object.prototype.toString;\n\n  function Spectrogram(canvas, options) {\n    if (!(this instanceof Spectrogram)) {\n      return new Spectrogram(canvas, options);\n    }\n\n    var baseCanvasOptions = options.canvas || {};\n    this._audioEnded = null;\n    this._paused = null;\n    this._pausedAt = null;\n    this._startedAt = null;\n    this._sources = {\n      audioBufferStream: null,\n      userMediaStream: null\n    };\n    this._baseCanvas = canvas;\n    this._baseCanvasContext = this._baseCanvas.getContext('2d');\n\n    this._baseCanvas.width = _result(baseCanvasOptions.width) || this._baseCanvas.width;\n    this._baseCanvas.height = _result(baseCanvasOptions.height) || this._baseCanvas.height;\n\n    window.onresize = function() {\n      this._baseCanvas.width = _result(baseCanvasOptions.width) || this._baseCanvas.width;\n      this._baseCanvas.height = _result(baseCanvasOptions.height) || this._baseCanvas.height;\n    }.bind(this);\n\n    var audioOptions = options.audio || {};\n    this.audio = audioOptions;\n\n    var colors = [];\n\n    if (typeof options.colors === 'function') {\n      colors = options.colors(275);\n    } else {\n      colors = this._generateDefaultColors(275);\n    }\n\n    this._colors = colors;\n\n    this._baseCanvasContext.fillStyle = this._getColor(0);\n    this._baseCanvasContext.fillRect(0, 0, this._baseCanvas.width, this._baseCanvas.height);\n  }\n\n  Spectrogram.prototype._init = function() {\n    var source = this._sources.audioBufferStream;\n    source.scriptNode = source.audioContext.createScriptProcessor(2048, 1, 1);\n    source.scriptNode.connect(source.audioContext.destination);\n    source.scriptNode.onaudioprocess = function(event) {\n      var array = new Uint8Array(source.analyser.frequencyBinCount);\n      source.analyser.getByteFrequencyData(array);\n\n      this._draw(array, source.canvasContext);\n    }.bind(this);\n\n    source.sourceNode.onended = function() {\n      this.clear();\n    }.bind(this);\n\n    source.analyser = source.audioContext.createAnalyser();\n    source.analyser.smoothingTimeConstant = 0;\n    source.analyser.fftSize = 4096;\n\n    source.analyser.connect(source.scriptNode);\n    source.sourceNode.connect(source.analyser);\n    if (this.audio.enable) {\n      source.sourceNode.connect(source.audioContext.destination);\n    }\n  };\n\n  Spectrogram.prototype._draw = function(array, canvasContext) {\n      console.log(slide)\n      if (this._paused) {\n        return false;\n      }\n\n      var canvas = canvasContext.canvas;\n      var width = canvas.width;\n      var height = canvas.height;\n      var tempCanvasContext = canvasContext._tempContext;\n      var tempCanvas = tempCanvasContext.canvas;\n      tempCanvasContext.drawImage(canvas, 0, 0, width, height);\n\n      for (var i = 0; i < array.length; i++) {\n        var value = array[i];\n        canvasContext.fillStyle = this._getColor(value);\n        if (this._audioEnded) {\n          canvasContext.fillStyle = this._getColor(0);\n        }\n        canvasContext.fillRect(slide, height - i, 1, 1);\n      }\n\n      // canvasContext.translate(-1, 0);\n      \n      // draw prev canvas before translation\n      canvasContext.drawImage(tempCanvas, 0, 0, width, height, 0, 0, width, height);\n      canvasContext.drawImage(tempCanvas, 0, 0, width, height, 0, 0, width, height);\n      // reset transformation matrix\n      canvasContext.setTransform(1, 0, 0, 1, 0, 0);\n\n      this._baseCanvasContext.drawImage(canvas, 0, 0, width, height);\n\n      if (!this._audioEnded) {slide += 1;}\n\n  };\n\n  Spectrogram.prototype._startMediaStreamDraw = function(analyser, canvasContext) {\n    window.requestAnimationFrame(this._startMediaStreamDraw.bind(this, analyser, canvasContext));\n    var audioData = new Uint8Array(analyser.frequencyBinCount);\n    analyser.getByteFrequencyData(audioData);\n    this._draw(audioData, canvasContext);\n  };\n\n  Spectrogram.prototype.connectSource = function(audioBuffer, audioContext) {\n    var source = this._sources.audioBufferStream || {};\n\n    // clear current audio process\n    if (toString.call(source.scriptNode) === '[object ScriptProcessorNode]') {\n      source.scriptNode.onaudioprocess = null;\n    }\n\n    if (toString.call(audioBuffer) === '[object AudioBuffer]') {\n      audioContext = (!audioContext && source.audioBuffer.context) || (!audioContext && source.audioContext) || audioContext;\n\n      var sourceNode = audioContext.createBufferSource();\n      sourceNode.buffer = audioBuffer;\n\n      var canvasContext = source.canvasContext;\n\n      if (!source.canvasContext) {\n        var canvas = document.createElement('canvas');\n        canvas.width = this._baseCanvas.width;\n        canvas.height = this._baseCanvas.height;\n        canvasContext = canvas.getContext('2d');\n\n        var tempCanvas = document.createElement('canvas');\n        tempCanvas.width = canvas.width;\n        tempCanvas.height = canvas.height;\n\n        canvasContext._tempContext = tempCanvas.getContext('2d');\n      }\n\n      source = {\n        audioBuffer: audioBuffer,\n        audioContext: audioContext,\n        sourceNode: sourceNode,\n        analyser: null,\n        scriptNode: null,\n        canvasContext: canvasContext\n      };\n\n      this._sources.audioBufferStream = source;\n      this._init();\n    }\n\n    if (toString.call(audioBuffer) === '[object AnalyserNode]') {\n      source = this._sources.userMediaStream || {};\n      source.analyser = audioBuffer;\n      this._sources.userMediaStream = source;\n    }\n  };\n\n  Spectrogram.prototype.start = function(offset, resolve) {\n    //set global resolveFunction to resolve that resolves canvasPromise (resolution in stop)\n    resolveFunction = resolve;\n\n    var source = this._sources.audioBufferStream;\n    var sourceMedia = this._sources.userMediaStream;\n\n    if (source && source.sourceNode) {\n      source.sourceNode.start(0, offset||0);\n      this._audioEnded = false;\n      this._paused = false;\n      this._startedAt = Date.now();\n    }\n\n    // media stream uses an analyser for audio data\n    if (sourceMedia && sourceMedia.analyser) {\n      source = sourceMedia;\n      var canvas = document.createElement('canvas');\n      canvas.width = this._baseCanvas.width;\n      canvas.height = this._baseCanvas.height;\n      var canvasContext = canvas.getContext('2d');\n\n      var tempCanvas = document.createElement('canvas');\n      tempCanvas.width = canvas.width;\n      tempCanvas.height = canvas.height;\n\n      canvasContext._tempContext = tempCanvas.getContext('2d');\n\n      this._startMediaStreamDraw(source.analyser, canvasContext);\n    }\n  };\n\n  Spectrogram.prototype.stop = function() {\n    \n    var source = this._sources[Object.keys(this._sources)[0]];\n    if (source && source.sourceNode) {\n      source.sourceNode.stop();\n    }\n    slide = 0;\n    this._audioEnded = true;\n\n    resolveFunction() //resolve canvasPromise\n\n  };\n\n  Spectrogram.prototype.pause = function() {\n    this.stop();\n    this._paused = true;\n    this._pausedAt += Date.now() - this._startedAt;\n  };\n\n  Spectrogram.prototype.resume = function(offset) {\n    var source = this._sources[Object.keys(this._sources)[0]];\n    this._paused = false;\n    if (this._pausedAt) {\n      this.connectSource(source.audioBuffer, source.audioContext);\n      this.start(offset || (this._pausedAt / 1000));\n    }\n  };\n\n  Spectrogram.prototype.clear = function(canvasContext) {\n    var source = this._sources[Object.keys(this._sources)[0]];\n\n    this.stop();\n\n    if (toString.call(source.scriptNode) === '[object ScriptProcessorNode]') {\n      source.scriptNode.onaudioprocess = null;\n    }\n\n    // canvasContext = canvasContext || source.canvasContext;\n    // var canvas = canvasContext.canvas;\n    // canvasContext.clearRect(0, 0, canvas.width, canvas.height);\n    // canvasContext._tempContext.clearRect(0, 0, canvas.width, canvas.height);\n    // this._baseCanvasContext.clearRect(0, 0, canvas.width, canvas.height);\n  };\n\n  Spectrogram.prototype._generateDefaultColors = function(steps) {\n    var frequency = Math.PI / steps;\n    var amplitude = 127;\n    var center = 128;\n    var slice = (Math.PI / 2) * 3.1;\n    var colors = [];\n\n    function toRGBString(v) {\n      return 'rgba(' + [v,v,v,1].toString() + ')';\n    }\n\n    for (var i = 0; i < steps; i++) {\n      var v = (Math.sin((frequency * i) + slice) * amplitude + center) >> 0;\n\n      colors.push(toRGBString(v));\n    }\n\n    return colors;\n  };\n\n  Spectrogram.prototype._getColor = function(index) {\n    var color = this._colors[index>>0];\n\n    if (typeof color === 'undefined') {\n      color = this._colors[0];\n    }\n\n    return color;\n  };\n\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      exports = module.exports = Spectrogram;\n    }\n    exports.Spectrogram = Spectrogram;\n  } else {\n    root.Spectrogram = Spectrogram;\n  }\n\n})(this);\n","module.exports = __webpack_public_path__ + \"static/media/DJB.e4210c98.ttf\";","module.exports = __webpack_public_path__ + \"static/media/Poppins-Regular.de2dd933.otf\";","// @ts-ignore\nimport React from 'react';\nimport chroma from 'chroma-js';\n// import spectrogram from 'spectrogram';\n// import spectrogram from 'spectrogram-fork';\nimport spectrogram from './spectrogram/spectrogram';\nimport { ReactMic } from '@cleandersonlobo/react-mic';\nimport Button from 'react-bootstrap/Button';\nimport DropdownButton from 'react-bootstrap/DropdownButton';\nimport Dropdown from 'react-bootstrap/Dropdown';\n\nimport './App.css';\nimport redCircle from'./images/red_circle.png';\n\nclass Audio extends React.Component {\n    constructor(props) {\n        super(props)\n\n        this.maxAudioTime = 1\n        this.startRecording = this.startRecording.bind(this)\n        this.stopRecording = this.stopRecording.bind(this)\n        this.onStop = this.onStop.bind(this)\n        this.decrement = this.decrement.bind(this)\n        this.timer = this.timer.bind(this)\n        this.getSpectrogram = this.getSpectrogram.bind(this)\n        this.formatRecordButtonText = this.formatRecordButtonText.bind(this)\n\n        this.state = { \n            record: false,\n            countdown: this.maxAudioTime,   \n            allLabels: this.props.allLabels,\n            currentLabel: this.props.allLabels.length === 0 ? undefined : this.props.allLabels[0],        \n        }\n\n    }\n\n    componentWillReceiveProps(nextProps) {\n        this.setState({ allLabels: nextProps.allLabels });\n        if(this.state.currentLabel === undefined) {\n            this.setState({currentLabel: nextProps.allLabels[0]})\n        } \n        \n    }\n    \n    decrement = () => {\n        this.setState({countdown: this.state.countdown-1}, () => {\n            if(this.state.countdown === 0) {\n                this.stopRecording()\n                this.setState({countdown: this.maxAudioTime})\n            }\n            else {\n                this.timer()\n            }\n        })\n        \n    }\n\n    timer = () => {\n        var t = setTimeout(this.decrement, 1000);\n    }\n\n    startRecording = () => {\n        this.setState({\n          record: true\n        });\n        this.timer()\n    }\n    \n    stopRecording = () => {\n        this.setState({\n            record: false\n        });\n    }\n\n    onStop = (recordedBlob) => {\n        console.log('recordedBlob is: ', recordedBlob);\n        console.log('recordedBlob.blob is: ', recordedBlob.blob);\n\n        this.getSpectrogram(recordedBlob).then(reader => {\n            reader.onload = () => { \n                let result = reader.result;\n                // console.log(\"IMAGE STATE UPDATED\")\n                // this.setState({image: result}); \n                this.props.handleNewImage(result, this.state.currentLabel)\n            }\n        })\n\n        // this.getSpectrogram(recordedBlob)\n\n        // var blob = new Blob([recordedBlob], {type: \"audio/wav\"})\n        // var url = window.URL.createObjectURL(blob);\n    \n        // this.href = url;\n        // this.target = '_blank';\n        \n        // // target filename\n        // this.download = 'test.wav';\n\n        // var a = document.createElement(\"a\");\n        // document.body.appendChild(a);\n        // a.style = \"display: none\";\n        // var blob = new Blob([recordedBlob.blob], {type: \"audio/wav\"}),\n        //     url = window.URL.createObjectURL(blob);\n        // a.href = url;\n        // a.download = \"bbb.wav\";\n        // a.click();\n        // window.URL.revokeObjectURL(url);\n        // document.body.removeChild(a);\n    }\n\n    formatRecordButtonText() {\n        if(this.state.record) {\n            return <img src={redCircle} width={10} height={10}/>\n        }\n    }\n\n    getSpectrogram = async (recordedBlob) => {\n        console.log(\"AUDIO BLOB:\")\n        console.log(recordedBlob)\n\n        const response = await fetch('/spectrogram', {\n            method: 'POST',\n            body: recordedBlob.blob\n        });\n        const blob = await response.blob()\n        // let matrixBlob = new Blob([res.data], {type:\"image/png\"}); \n        let reader = new FileReader();\n        reader.readAsDataURL(blob); \n        return reader;\n\n        // var canvas = document.createElement('canvas')\n        // canvas.width = 200;\n        // canvas.height = 200;\n        // // document.body.appendChild(canvas)\n \n        // var spectro = spectrogram(canvas, {\n        //     audio: {\n        //         enable: false\n        //     },\n        //     colors: (steps) => {\n        //         var baseColors = [[65,65,90,1], [0,255,255,1], [0,255,0,1], [255,255,0,1], [ 255,0,0,1]];\n        //         var positions = [0, 0.15, 0.30, 0.50, 0.75];\n             \n        //         var scale = new chroma.scale(baseColors, positions)\n        //         .domain([0, steps]);\n             \n        //         var colors = [];\n             \n        //         for (var i = 0; i < steps; ++i) {\n        //           var color = scale(i);\n        //           colors.push(color.hex());\n        //         }\n             \n        //         return colors;\n        //       }\n        // });\n        \n        // var audioContext = new AudioContext({sampleRate: 384000});\n        // var request = new XMLHttpRequest();\n        // request.open('GET', URL.createObjectURL(recordedBlob.blob), true);\n        // request.responseType = 'arraybuffer';\n\n        // request.onload = () => {\n        //     audioContext.decodeAudioData(request.response, (buffer) => {\n        //         spectro.connectSource(buffer, audioContext);\n        //         var canvasPromise = new Promise(function(resolve, reject) {\n        //             spectro.start(0, resolve);\n        //         })\n        //         canvasPromise.then(() => {\n        //             console.log(\"Promise Resolved\")\n        //             var dataURL = canvas.toDataURL();\n        //             this.props.handleNewImage(dataURL, this.state.currentLabel)\n        //         })\n        //     });\n        // };\n        // request.send();\n        \n\n\n\n\n    }\n\n    handleDropdownSelect(selectedLabel) {\n        this.setState({currentLabel: selectedLabel})\n    }\n\n    render () {\n        return (\n            <div className=\"record-box\">\n                <div className=\"recording-for-dropdown-wrapper\">\n                    <a className=\"record-p\">RECORDING FOR: &nbsp;</a>\n                    <DropdownButton \n                        disabled={this.state.allLabels.length === 0}\n                        title={this.state.allLabels.length === 0 ? \"No Labels\" : this.state.currentLabel} \n                        size=\"sm\" \n                        variant=\"outline-light\"\n                    >\n                        {this.state.allLabels.map(l => {\n                            return (\n                                <Dropdown.Item key={l} onClick={() => this.handleDropdownSelect(l)}>{l}</Dropdown.Item>\n                            )\n                        })}\n                    </DropdownButton>\n                </div>\n                <ReactMic\n                    record={this.state.record}\n                    className=\"sound-wave\"\n                    onStop={this.onStop}\n                    strokeColor=\"#adc2ff\"\n                    backgroundColor=\"#1a1a1d\" \n                    width={200}\n                    height={140}\n                    />\n                <div className=\"record-and-countdown\">\n                    <Button onClick={this.startRecording} disabled={this.state.allLabels.length === 0} variant=\"outline-light\" className=\"record-button\">\n                        {this.state.record ? [\n                            <img key={0} src={redCircle} width={10} height={10}/>,\n                            <span key={1}>&nbsp;&nbsp;</span>,\n                            \"Recording\",\n                        ] : \"Record\"}\n                        {/* {<img src={redCircle} width={10} height={10}/>} &#8239; {this.state.record ? \"Recording 0:0\" + this.state.countdown : \"Record\"} */}\n                    </Button>\n                    <p className=\"countdown\">{\"0:0\" + (this.maxAudioTime - this.state.countdown)}</p>\n                </div>\n                \n                {/* <img src={this.state.image} height=\"100\" alt=\"Image preview...\"></img> */}\n            </div>\n        )\n        \n    }\n}\n\nexport default Audio;\n","// @ts-ignore\nimport React from 'react';\nimport Button from 'react-bootstrap/Button';\nimport './App.css';\nimport Audio from './Audio.js';\nimport arrow from'./images/arrow.png';\n\nclass Label extends React.Component {\n    constructor(props) {\n        super(props)\n\n        this.state = { \n            images: this.props.images,\n            name: this.props.name,\n        }\n\n    }\n\n    componentWillReceiveProps(nextProps) {\n        this.setState({ images: nextProps.images });  \n    }\n\n    render () {\n        return (\n            <div className=\"label-border scale-in-center\">\n                <div className=\"label-box\">\n                    <div className=\"title-box\">\n                        <p className=\"name-p\">{this.state.name}</p>\n                        <p className=\"count-p\">{this.state.images.length + (this.state.images.length === 1 ? \" example\" : \" examples\")}</p>\n                    </div>\n                    <div className=\"vertical-line\">\n                        <img src={arrow} width={10} style={{margin: \"auto\"}}></img>\n                    </div>\n \n                        {/* <p className=\"image-text\">0 EXAMPLES</p> */}\n                    <div className=\"image-box\">\n                        {this.state.images.map(i => {\n                            return (\n                                <div id=\"image-wrapper\" key={i}>\n                                    <img src={i} className=\"image hover\"></img>\n                                    <p className=\"text\" onClick={() => this.props.handleRemoveImage(i, this.state.name)}>x</p>\n                                </div>\n                            )\n                        })}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Label;\n","// @ts-ignore\nimport React from 'react';\nimport { useState } from 'react';\nimport InputGroup from 'react-bootstrap/InputGroup';\nimport FormControl from 'react-bootstrap/FormControl'\nimport Form from 'react-bootstrap/Form'\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\nimport Modal from 'react-bootstrap/Modal';\n\nimport Popover from 'react-bootstrap/Popover'\nimport './App.css';\nimport Label from './Label.js';\nimport Audio from './Audio.js';\nimport Button from 'react-bootstrap/Button';\n\nimport plus from'./images/plus.png';\nimport { Link } from 'react-router-dom';\n\nimport Navbar from 'react-bootstrap/Navbar';\nimport Nav from 'react-bootstrap/Nav';\n\n\nclass LabelView extends React.Component {\n    constructor(props) {\n        super(props)\n        this.handleNewImage = this.handleNewImage.bind(this)\n        this.handleRemoveImage = this.handleRemoveImage.bind(this)\n        this.handleLabelKeyDown = this.handleLabelKeyDown.bind(this)\n        this.createNewLabel = this.createNewLabel.bind(this)\n        this.tuneModal = this.tuneModal.bind(this)\n\n        this.state = { \n            imageMap: this.props.location.state === undefined ? {} : this.props.location.state.imageMap,\n        }\n    }\n\n\n    downloadURI(uri, name) {\n        var link = document.createElement(\"a\");\n        link.download = name;\n        link.href = uri;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n    }\n\n    handleNewImage(image, currentLabel) {\n        this.setState({\n            imageMap: {\n                ...this.state.imageMap,\n                [currentLabel]: [...this.state.imageMap[currentLabel], image]\n            }\n        })\n\n        // this.downloadURI(image, currentLabel)\n    }\n\n    handleRemoveImage(i, name) {\n        var images = [...(this.state.imageMap[name])]\n        var index = images.indexOf(i)\n        if (index !== -1) {\n            images.splice(index, 1);\n            this.setState({imageMap: {\n                ...this.state.imageMap,\n                [name]: images\n            }});\n        }\n    }\n\n    handleLabelKeyDown(e) {\n        if(e.keyCode === 13) {\n            this.createNewLabel(e.target.value)\n            document.body.click()\n        }\n    }\n\n    createNewLabel(labelName) {\n        this.setState({imageMap: {\n            ...this.state.imageMap,\n            [labelName]: []\n        }})\n    }\n\n    tuneModal() {\n        const [show, setShow] = useState(false);\n      \n        const handleClose = () => setShow(false);\n        const handleShow = () => setShow(true);\n      \n        return (\n          <>\n            <Button \n                variant=\"dark\" \n                size=\"sm\" \n                className=\"train-button\" \n                onClick={handleShow} \n                disabled={Object.keys(this.state.imageMap).length > 0 && Math.min(...Object.keys(this.state.imageMap).map(k => this.state.imageMap[k].length)) > 1 ? false : true}\n            >\n                Train\n            </Button>\n            <Modal show={show} onHide={handleClose} centered>\n                <Modal.Header closeButton>\n                    <Modal.Title>Customize Hyperparameters</Modal.Title>\n                </Modal.Header>\n                <Modal.Body></Modal.Body>\n                <Form>\n                    <Form.Group controlId=\"exampleForm.ControlInput1\">\n                        <Form.Label>Learning Rate</Form.Label>\n                        <Form.Control type=\"number\" defaultValue=\"0.0001\" step=\".0001\" />\n                    </Form.Group>\n                    <Form.Group controlId=\"exampleForm.ControlSelect1\">\n                        <Form.Label>Optimizer</Form.Label>\n                        <Form.Control as=\"select\">\n                        <option>Adam</option>\n                        <option>SGD</option>\n                        <option>Adagrad</option>\n                        <option>Adadelta</option>\n                        </Form.Control>\n                    </Form.Group>\n                    <Form.Group controlId=\"exampleForm.ControlInput2\">\n                        <Form.Label>Epochs</Form.Label>\n                        <Form.Control type=\"number\" defaultValue=\"20\" step=\"1\" />\n                    </Form.Group>\n                    <Form.Group controlId=\"exampleForm.ControlInput2\">\n                        <Form.Label>Training Data Fraction</Form.Label>\n                        <Form.Control type=\"number\" defaultValue=\".4\" step=\".1\" />\n                    </Form.Group>\n                </Form>\n                <Modal.Footer>\n                <Button variant=\"danger\" onClick={handleClose}>\n                    Close\n                </Button>\n                <Link to={{ pathname: \"/test\", state: {imageMap: this.state.imageMap}}}>\n                    <Button variant=\"warning\">  Train Model </Button>\n                </Link>\n                </Modal.Footer>\n            </Modal>\n          </>\n        );\n      }\n\n    render () {\n        console.log(this.state.imageMap)\n        return (\n            <header className=\"App-header\">\n                <Navbar bg=\"dark\" variant=\"dark\">\n                    <Navbar.Brand href=\"/\">Personal Audio Classifier</Navbar.Brand>\n                    <Nav className=\"mr-auto\">\n                        <Link to={{ pathname: \"/\", state: {imageMap: this.state.imageMap}}}>\n                            Train\n                        </Link>\n                        <Link to={{ pathname: \"/test\", state: {imageMap: this.state.imageMap}}} className={Object.keys(this.state.imageMap).length > 0 && Math.min(...Object.keys(this.state.imageMap).map(k => this.state.imageMap[k].length)) > 1 ? \"\": \"disable-link\"}>\n                            Test\n                        </Link>\n                        <Link to={{ pathname: \"/\", state: {imageMap: this.state.imageMap}}}>\n                            Export\n                        </Link>\n                        {/* <Nav.Link>Train</Nav.Link>\n                        <Nav.Link>Test</Nav.Link>\n                        <Nav.Link>Export</Nav.Link> */}\n                    </Nav>\n                </Navbar>\n                <div className=\"view-all\">\n                <Audio \n                    handleNewImage={this.handleNewImage}\n                    allLabels={Object.keys(this.state.imageMap)}/>\n                <div className=\"all-labels\">\n                    <div className=\"plus-wrapper\">\n                        <OverlayTrigger\n                            trigger=\"click\"\n                            placement={\"right\"}\n                            rootClose={true}\n                            overlay={\n                                <Popover>\n                                    <Popover.Title \n                                        as=\"h3\">{\"Create New Label\"}</Popover.Title>\n                                    <Popover.Content>\n                                    <input \n                                        type=\"text\" \n                                        name=\"name\" \n                                        autoFocus={true} \n                                        onKeyDown={this.handleLabelKeyDown}\n                                    />\n                                    </Popover.Content>\n                                </Popover>\n                            }\n                            >\n                            <img src={plus} className=\"plus\"></img>\n                        </OverlayTrigger>\n                    \n                        {/* {Object.keys(this.state.imageMap).length > 0 && Math.min(...Object.keys(this.state.imageMap).map(k => this.state.imageMap[k].length)) > 1 && \n                            <this.tuneModal/>\n                        } */}\n                        {Object.keys(this.state.imageMap).length > 0  && \n                            <this.tuneModal/>\n                        }\n                    </div>\n                    {Object.keys(this.state.imageMap).map(k => {\n                        return (\n                            <Label \n                                name={k}\n                                images={this.state.imageMap[k]}\n                                handleRemoveImage={this.handleRemoveImage}\n                                key={k}/>\n                        )\n                    })}\n                </div>\n\n            </div>\n                <div></div>\n            </header>\n        )\n    }\n}\n\nexport default LabelView;\n","// @ts-ignore\nimport React from 'react';\nimport ProgressBar from 'react-bootstrap/ProgressBar';\nimport Button from 'react-bootstrap/Button';\nimport * as tf from '@tensorflow/tfjs';\n\nimport './App.css';\n\nclass Loading extends React.Component {\n    constructor(props) {\n        super(props)\n\n        this.state = { \n            imageMap: this.props.location.state.imageMap,\n            transferModel: undefined,\n            customModel: undefined,\n            trainActivations: undefined,\n\n            progress: 0,\n            message: \"Loading...\",\n            loss: 1,\n        }\n    }\n\n    async componentDidMount() {\n        await this.train()\n    }\n\n    async train() {\n        const transferModel = await this.getTransferModel();\n        const customModel = this.getCustomModel()\n        customModel.summary()\n\n        const {images, labels} = await this.generateInputTensors();\n        const activations = this.generateActivations(images, transferModel);\n\n        this.setState({\n            trainActivations: activations,\n            customModel: customModel,\n            transferModel: transferModel,\n        })\n\n        await this.fitCustomModel(activations, labels, customModel)\n       \n        console.log(\"done\")\n\n        const saveResultsCustom = await customModel.save('localstorage://customModel');\n        const saveResultsTransfer = await transferModel.save('localstorage://transferModel');\n\n        console.log(saveResultsTransfer)\n        console.log(saveResultsCustom)\n\n        this.props.history.push({\n            pathname: '/test',\n            state: {\n                customMode: this.state.customModel\n            }\n        })\n    }\n\n    async getTransferModel() {\n        console.log('Loading mobilenet..');\n        this.setState({message: \"Loading mobilenet...\", progress: 10})\n\n        const model = await tf.loadLayersModel(\n            \"https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json\"\n        );\n        console.log('Successfully loaded model');\n\n        const layer = model.getLayer(\"conv_pw_13_relu\")\n        let modelModified = tf.model({inputs: model.inputs, outputs: layer.output, name: 'modelModified' });\n        console.log('Mobilenet model is modified')\n        setTimeout(() => this.setState({message: \"Truncating mobilenet...\", progress: 30}), 0)\n\n        modelModified.summary()\n        return modelModified\n    }\n\n    getCustomModel() {\n        console.log('Building the model...');\n        setTimeout(() => this.setState({message: \"Building custom model...\", progress: 40}), 0)\n\n        var model = tf.sequential();\n        model.add(tf.layers.conv2d({ \n            inputShape: [7, 7, 256],\n            kernelSize: 5,\n            filters: 5, \n            strides: 1, \n            activation: 'relu',\n            kernelInitializer: 'varianceScaling'}))\n        \n        model.add(tf.layers.flatten())\n\n        model.add(tf.layers.dense({\n            units: 100, \n            kernelInitializer: 'varianceScaling', \n            useBias: true,\n            activation: 'relu'}))\n\n        model.add(tf.layers.dense({\n            kernelInitializer: 'varianceScaling',\n            units: Object.keys(this.state.imageMap).length,\n            useBias: false,\n            activation: 'softmax'}))\n\n        model.compile({optimizer: tf.train.adam(.0001), loss: 'categoricalCrossentropy'});\n        return model\n    }\n\n    async fitCustomModel(activations, labels, customModel) {\n        let batchSize = Math.floor(activations.shape[0] * .4)\n        try {\n            await customModel.fit(activations, labels, {\n                batchSize,\n                epochs: 20,\n                callbacks: {\n                  onBatchEnd: async (batch, logs) => {\n                    this.setState({message: \"Training model... loss: \" + logs.loss.toFixed(5) + \"\", progress: this.state.progress + 1})\n                    console.log('Loss: ' + logs.loss.toFixed(5));\n                  },\n                }\n              }); \n        } catch(e) {\n            console.log(e)\n        }\n    }\n\n    async generateInputTensors() {\n        setTimeout(() => this.setState({message: \"Generating input tensors...\", progress: 30}), 300)\n\n        const imageTensors = [];\n        const labelTensors = [];\n\n        var imageMapConverted = {}\n        for(let label in this.state.imageMap) {\n            imageMapConverted[label] = []\n        }\n\n        for(let label in this.state.imageMap) {\n            for(let imgIndex in this.state.imageMap[label]) {\n                var convertedImg = await this.convertImg(this.state.imageMap[label][imgIndex])\n                imageMapConverted[label].push(convertedImg)\n            }\n        }\n\n        var allLabels = Object.keys(imageMapConverted).sort()\n        allLabels.forEach(label => {\n            console.log(label)\n            imageMapConverted[label].forEach(tensor => {\n                imageTensors.push(tensor)\n                var labelTensor = []\n                allLabels.forEach(l => {\n                    labelTensor.push(l === label ? 1 : 0)\n                })\n                console.log(labelTensor)\n                labelTensors.push(labelTensor)\n            })\n        })\n        var images = tf.stack(imageTensors)\n        var labels = tf.stack(labelTensors)\n        return {images, labels}\n    }\n\n    async convertImg(imgUrl) {\n        const load = () => new Promise((resolve, reject) => {\n            var img = new Image()\n            img.onload = () => {\n              resolve({img})\n            }\n            img.src = imgUrl\n            img.width = 200;\n            img.height = 200;\n          });\n      \n        const {img} = await load()\n        const trainImage = tf.browser.fromPixels(img).resizeNearestNeighbor([224,224]);\n        const trainImageNormalized =  trainImage.toFloat().div(tf.scalar(127)).sub(tf.scalar(1));\n        return trainImageNormalized;\n    }\n\n    generateActivations(images, transferModel) {\n        let activations = []\n        tf.unstack(images).forEach(image => {\n            let activation = transferModel.predict(\n                tf.stack(\n                    [image]\n            ))\n            activations.push(tf.unstack(activation)[0])\n        })\n        return tf.stack(activations)\n    }\n\n    render() {\n        console.log(this.state)\n        return (\n            <div className=\"loading\">\n                <p className=\"message\">{this.state.message}</p>\n                <ProgressBar animated variant=\"warning\" style={{width: \"500px\"}} now={this.state.progress} />              \n            </div>\n        )\n    }\n}\n\nexport default Loading","// @ts-ignore\nimport React from 'react';\nimport * as JSZip from 'jszip';\nimport * as FileSaver from 'file-saver';\nimport Button from 'react-bootstrap/Button';\nimport { ReactMic } from '@cleandersonlobo/react-mic';\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\nimport Popover from 'react-bootstrap/Popover'\nimport Jumbotron from 'react-bootstrap/Jumbotron'\nimport Container from 'react-bootstrap/Container'\nimport Alert from 'react-bootstrap/Alert';\nimport ProgressBar from 'react-bootstrap/ProgressBar';\nimport './App.css';\nimport * as tf from '@tensorflow/tfjs';\n\n// import * as mobilenet from './models/mobilenet.json';\nimport Audio from './Audio.js';\n// import * as mobilenet from '@tensorflow-models/mobilenet';\n\nimport Navbar from 'react-bootstrap/Navbar';\nimport Nav from 'react-bootstrap/Nav';\n\nimport { Link } from 'react-router-dom';\n\nimport { Link as ScrollLink, animateScroll as AnimateScroll } from \"react-scroll\";\n\nclass TestView extends React.Component {\n    constructor(props) {\n        super(props)\n        this.canvasRef = React.createRef();\n\n        this.handleTestImage = this.handleTestImage.bind(this)\n        this.exportModel = this.exportModel.bind(this)\n\n        this.state = { \n            imageMap: this.props.location.state.imageMap,\n\n            transferModel: undefined,\n            customModel: undefined,\n            trainActivations: undefined,\n\n            testImage: undefined,\n            testRanks: undefined,\n            testConfidences: undefined,\n            testResults: undefined,\n\n            loading: true,\n            progress: 0,\n            message: \"Loading...\"\n        }\n    }\n\n    async componentDidMount() {\n        // if(Math.random() < .5) {\n        //     this.setState({testLabel: Object.keys(this.state.imageMap).sort()[0]})\n        // } else {\n        //     this.setState({testLabel: Object.keys(this.state.imageMap).sort()[1]})\n        // }\n        \n        await this.train()\n    }\n\n    async getTransferModel() {\n        // const trainableLayers = [\n        //     'denseModified',\n        //     'conv_pw_13_bn',\n        //     'conv_pw_13',\n        //     'conv_dw_13_bn',\n        //     'conv_dw_13'\n        // ];\n        console.log(tf.version.tfjs)\n        console.log('Loading mobilenet..');\n        this.setState({message: \"Loading mobilenet...\", progress: 20})\n\n        // const model = await tf.loadLayersModel(\"http://localhost:3000/mobilenet\");\n        const model = await tf.loadLayersModel(\n            \"https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json\"\n        );\n\n        console.log('Successfully loaded model');\n        \n        // const x=model.getLayer('global_average_pooling2d_1');\n        // const predictions= tf.layers.dense({\n        //     units: Object.keys(this.state.imageMap).length,  \n        //     activation: 'softmax', \n        //     name: 'denseModified'\n        // }).apply(x.output); \n        const layer = model.getLayer(\"conv_pw_13_relu\")\n        let modelModified = tf.model({inputs: model.inputs, outputs: layer.output, name: 'modelModified' });\n        console.log('Mobilenet model is modified')\n        this.setState({message: \"Truncating mobilenet...\", progress: 50})\n\n        // modelModified = this.freezeModelLayers(trainableLayers,modelModified)\n        // console.log('ModifiedMobilenet model layers are frozen')\n\n        // modelModified.compile({\n        //     loss: \"categoricalCrossentropy\",  \n        //     optimizer: tf.train.adam(1e-3), \n        //     metrics:   ['accuracy','crossentropy']\n        // });\n\n        modelModified.summary()\n        // model.dispose()\n        return modelModified\n    }\n\n    async getImg(imgUrl) {\n        const load = () => new Promise((resolve, reject) => {\n            var img = new Image()\n            img.onload = () => {\n              resolve({img})\n            }\n            img.src = imgUrl\n            img.width = 200;\n            img.height = 200;\n          });\n      \n        const {img} = await load()\n        return img\n    }\n\n    async convertImg(imgUrl) {\n        const load = () => new Promise((resolve, reject) => {\n            var img = new Image()\n            img.onload = () => {\n              resolve({img})\n            }\n            img.src = imgUrl\n            img.width = 200;\n            img.height = 200;\n          });\n      \n        const {img} = await load()\n\n        // var canvas = document.createElement('canvas');\n        // var context = canvas.getContext('2d');\n        // context.drawImage(img, 0, 0);\n        // var imageData = context.getImageData(0, 0, img.width, img.height);\n\n        // console.log(imageData)\n        // console.log(this.canvasRef)\n\n        // this.canvasRef.current.getContext(\"2d\").putImageData(imageData, 0, 0)\n        // this.imageRef.current.src = imgUrl;\n        \n        // document.body.appendChild(img)\n\n        const trainImage = tf.browser.fromPixels(img).resizeNearestNeighbor([224,224]);\n        // this.canvasRef.current.getContext(\"2d\").clearRect(0, 0, this.canvasRef.current.width, this.canvasRef.current.height)\n        // tf.browser.toPixels(trainImage, this.canvasRef.current)\n        const trainImageNormalized =  trainImage.toFloat().div(tf.scalar(127)).sub(tf.scalar(1));\n        return trainImageNormalized;\n    }\n\n    async train() {\n        const transferModel = await this.getTransferModel();\n        const customModel = this.getCustomModel()\n\n        customModel.summary()\n\n        const {images, labels} = await this.generateInputTensors();\n        const activations = this.generateActivations(images, transferModel);\n        \n        const testResults = {}\n        Object.keys(this.state.imageMap).sort().forEach((k) => {\n            testResults[k] = []\n        })\n\n        this.setState({\n            trainActivations: activations,\n            customModel: customModel,\n            transferModel: transferModel,\n            testResults: testResults,\n        })\n\n        await this.fitCustomModel(activations, labels, customModel)\n       \n        console.log(\"done\")\n\n        this.setState({loading: false})\n\n        // const testImgUrl = this.state.imageMap[\"Hello\"][0]\n        // const testImgUrl2 = this.state.imageMap[\"Hello\"][1]\n\n        // console.log(this.convertImg(testImgUrl).shape)\n        // console.log(tf.stack([this.convertImg(testImgUrl)]).shape)\n\n        // const input = tf.stack([this.convertImg(testImgUrl), this.convertImg(testImgUrl2)])\n        // const layers = modelModified.layers\n        // for (var i = 1; i < 2; i ++) {\n        //     var layer = layers[i]\n        //     var output = layer.apply(input)\n        //     input = output\n        //     output.print()\n        // }\n\n        // const modelTest = tf.model({\n        //     inputs: modelModified.layers[0].input,\n        //     outputs: modelModified.layers[5].output\n        // })\n        // const result = await modelTest.predict(\n        //     tf.stack(\n        //         [this.convertImg(testImgUrl)]\n        //     )\n        // )\n        // console.log(result)\n\n        // const input = tf.input({shape: [5]});\n        // const denseLayer1 = tf.layers.dense({units: 10, activation: 'relu'});\n        // const denseLayer2 = tf.layers.dense({units: 4, activation: 'softmax'});\n        // const output = denseLayer2.apply(denseLayer1.apply(input));\n        // const modelBasic = tf.model({inputs: input, outputs: output});\n        // modelBasic.summary()\n        // modelBasic.predict(tf.ones([2, 5])).print();\n    }\n\n    async fitCustomModel(activations, labels, customModel) {\n        let batchSize = Math.floor(activations.shape[0] * .4)\n        try {\n            await customModel.fit(activations, labels, {\n                batchSize,\n                epochs: 20,\n                callbacks: {\n                  onBatchEnd: async (batch, logs) => {\n                    console.log('Loss: ' + logs.loss.toFixed(5));\n                    this.setState({message: \"Training model... loss: \" + logs.loss.toFixed(5) + \"\", progress: this.state.progress + 3})\n                  },\n                }\n              }); \n        } catch(e) {\n            console.log(e)\n        }\n    }\n\n    generateActivations(images, transferModel) {\n        let activations = []\n        tf.unstack(images).forEach(image => {\n            let activation = transferModel.predict(\n                tf.stack(\n                    [image]\n            ))\n            activations.push(tf.unstack(activation)[0])\n        })\n        return tf.stack(activations)\n    }\n\n    getCustomModel() {\n        // function onBatchEnd(batch, logs) {\n        //     console.log('Accuracy', logs.acc);\n        //     console.log('CrossEntropy', logs.ce);\n        //     console.log('All', logs);\n        // }\n        console.log('Building the model...');\n        this.setState({message: \"Building custom model...\", progress: 70})\n\n        var model = tf.sequential();\n\n        model.add(tf.layers.conv2d({ \n            inputShape: [7, 7, 256],\n            kernelSize: 5,\n            filters: 5, \n            strides: 1, \n            activation: 'relu',\n            kernelInitializer: 'varianceScaling'}))\n        \n        model.add(tf.layers.flatten())\n\n        model.add(tf.layers.dense({\n            units: 100, \n            kernelInitializer: 'varianceScaling', \n            useBias: true,\n            activation: 'relu'}))\n\n        model.add(tf.layers.dense({\n            kernelInitializer: 'varianceScaling',\n            units: Object.keys(this.state.imageMap).length,\n            useBias: false,\n            activation: 'softmax'}))\n        \n        model.compile({optimizer: tf.train.adam(.0001), loss: 'categoricalCrossentropy'});\n        \n        return model\n\n        // await modelModified.fit(images, labels, \n        //     {\n        //       epochs: 5,\n        //       batchSize: 24,\n        //       validationSplit: 0.2,\n        //       callbacks: {onBatchEnd}\n           \n        //     }).then(info => {\n        //         console.log(\"\")\n        //         console.log('Final accuracy', info.history.acc);\n        //         console.log('Cross entropy', info.ce);\n        //         console.log('All', info);\n        //         console.log('All', info.history['acc'][0]);\n                \n        //         // for (let k = 0; k < 5; k++) {\n        //         //     this.traningMetrics.push({acc: 0, ce: 0 , loss: 0});\n            \n        //         //     this.traningMetrics[k].acc=info.history['acc'][k];\n        //         //     this.traningMetrics[k].ce=info.history['ce'][k];\n        //         //     this.traningMetrics[k].loss=info.history['loss'][k]; \n        //         // }\n        //         // images.dispose();\n        //         // labels.dispose();\n        //         // modelModified.dispose();\n        // });;\n    }\n\n    async generateInputTensors() {\n        const imageTensors = [];\n        const labelTensors = [];\n\n        var imageMapConverted = {}\n        for(let label in this.state.imageMap) {\n            imageMapConverted[label] = []\n        }\n\n        for(let label in this.state.imageMap) {\n            for(let imgIndex in this.state.imageMap[label]) {\n                var convertedImg = await this.convertImg(this.state.imageMap[label][imgIndex])\n                imageMapConverted[label].push(convertedImg)\n            }\n        }\n\n        var allLabels = Object.keys(imageMapConverted).sort()\n        allLabels.forEach(label => {\n            console.log(label)\n            imageMapConverted[label].forEach(tensor => {\n                imageTensors.push(tensor)\n                var labelTensor = []\n                allLabels.forEach(l => {\n                    labelTensor.push(l === label ? 1 : 0)\n                })\n                console.log(labelTensor)\n                labelTensors.push(labelTensor)\n                // console.log(\"Image and Label Tensors:\")\n                // console.log(imageTensors)\n                // console.log(labelTensors)\n            })\n        })\n        var images = tf.stack(imageTensors)\n        var labels = tf.stack(labelTensors)\n        return {images, labels}\n    }\n\n    async exportModel() {\n        // The TensorFlow.js save method doesn't work properly in Firefox, so we write\n        // our own. This methods zips up the model's topology file, weights files, and\n        // a json of the mapping of model predictions to label names. The resulting file\n        // is given the .mdl extension to prevent tampering with.\n        const zipSaver = {save: (modelSpecs) => {\n            const modelTopologyFileName = \"model.json\";\n            const weightDataFileName = \"model.weights.bin\";\n            const modelLabelsName = \"model_labels.json\";\n            const transferModelInfoName = \"transfer_model.json\";\n            const modelZipName = \"model.mdl\";\n\n            const weightsBlob = new Blob(\n            [modelSpecs.weightData], {type: 'application/octet-stream'});\n\n            const weightsManifest = [{\n            paths: ['./' + weightDataFileName],\n            weights: modelSpecs.weightSpecs\n            }];\n            const modelTopologyAndWeightManifest = {\n            modelTopology: modelSpecs.modelTopology,\n            weightsManifest\n            };\n            const modelTopologyAndWeightManifestBlob = new Blob(\n            [JSON.stringify(modelTopologyAndWeightManifest)],\n            {type: 'application/json'});\n\n            const zip = new JSZip();\n            zip.file(modelTopologyFileName, modelTopologyAndWeightManifestBlob);\n            zip.file(weightDataFileName, weightsBlob);\n            const labels = {}\n            Object.keys(this.state.imageMap).sort().forEach((label, i) => {\n                labels[i] = label\n            })\n            console.log(JSON.stringify(labels))\n            zip.file(modelLabelsName, JSON.stringify(labels));\n            zip.file(transferModelInfoName, \"{\\\"name\\\":\\\"mobilenet\\\",\\\"lastLayer\\\":\\\"conv_pw_13_relu\\\",\\\"url\\\":\\\"https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json\\\"}\");\n\n            zip.generateAsync({type:\"blob\"})\n            .then(function (blob) {\n                FileSaver.saveAs(blob, modelZipName);\n            });\n        }};\n\n        const savedModel = await this.state.customModel.save(zipSaver);\n    }\n\n\n    handleTestImage(image) {\n        console.log(\"image changed\")\n        this.setState({\n            testImage: image,\n        }, async () => await this.test())\n    }\n\n    async test() {\n        let transferModel = this.state.transferModel\n        let customModel = this.state.customModel\n        var convertedImg = await this.convertImg(this.state.testImage)\n        \n        var activation = transferModel.predict(\n            tf.stack([convertedImg])\n        )\n\n        var prediction = customModel.predict(activation)\n        var top = await prediction.topk(Object.keys(this.state.imageMap).length)\n        let confidences = await top.values.data()\n        let ranks = await top.indices.data()\n        console.log(confidences)\n        console.log(ranks)\n\n        var testRanks = {}\n        var testConfidences = {}\n        Object.keys(this.state.imageMap).sort().forEach((label, index)=> {\n            let rank =  ranks.indexOf(index)\n            if(rank == 0) {\n                this.setState({testResults: {\n                    ...this.state.testResults,\n                    [label]: [...this.state.testResults[label], [this.state.testImage, confidences[rank]]]\n                }})\n            }\n            testRanks[label] = rank\n            testConfidences[label] = confidences[rank]\n        })\n        console.log(testRanks)\n        this.setState({\n            testRanks: testRanks,\n            testConfidences: testConfidences,\n        })\n\n    }\n\n    render () {\n        console.log(this.state)\n        if(this.state.loading) {\n            return (\n                <header className=\"App-header\">\n                    <Navbar bg=\"dark\" variant=\"dark\">\n                        <Navbar.Brand href=\"/\">Personal Audio Classifier</Navbar.Brand>\n                        <Nav className=\"mr-auto\">\n                            <Link to={{ pathname: \"/\", state: {imageMap: this.state.imageMap}}}>\n                                Train\n                            </Link>\n                            <Link to={{ pathname: \"/test\", state: {imageMap: this.state.imageMap}}}>\n                                Test\n                            </Link>\n                            <Link to={{ pathname: \"/\", state: {imageMap: this.state.imageMap}}}>\n                                Export\n                            </Link>\n                            {/* <Nav.Link>Train</Nav.Link>\n                            <Nav.Link>Test</Nav.Link>\n                            <Nav.Link>Export</Nav.Link> */}\n                        </Nav>\n                    </Navbar>\n\n                    <div className=\"loading\">\n                        <p className=\"message\">{this.state.message}</p>\n                        <ProgressBar animated variant=\"warning\" style={{width: \"500px\"}} now={this.state.progress} />              \n                    </div>\n\n                    <div></div>\n                </header>\n            )\n        } else {\n            return (\n                <div>\n                    <header className=\"App-header\">\n                        <Navbar bg=\"dark\" variant=\"dark\">\n                            <Navbar.Brand href=\"/\">Spectrogram Audio Classifier</Navbar.Brand>\n                            <Nav className=\"mr-auto\">\n                                <Link to={{ pathname: \"/\", state: {imageMap: this.state.imageMap}}}>\n                                    Train\n                                </Link>\n                                <Link to={{ pathname: \"/test\", state: {imageMap: this.state.imageMap}}}>\n                                    Test\n                                </Link>\n                                <Link to={{ pathname: \"/\", state: {imageMap: this.state.imageMap}}}>\n                                    Export\n                                </Link>\n                            </Nav>\n                        </Navbar>\n                        <div className=\"view-all\">\n                            <Audio \n                                handleNewImage={this.handleTestImage}\n                                allLabels={Object.keys(this.state.imageMap)}/>\n                            <div className=\"test-pic-background\">\n                                <p className=\"test-pic-p\">SPECTROGRAM:</p>\n                                <img src={this.state.testImage} className=\"test-pic hover\"></img>\n                            </div>\n                            <div className=\"results-background\">\n                                <p className=\"classification-p\">CLASSIFICATION:</p>\n                                {Object.keys(this.state.imageMap).sort(\n                                    // (x,y) => {\n                                    //     if(this.state.testRanks[x] === 0) { return -1 }\n                                    //     if(this.state.testRanks[y] !== 0) { return  1 }\n                                    //     else { return 0 }\n                                    // }\n                                ).map((k, i, arr) => {\n                                    if(this.state.testRanks !== undefined) {\n                                        return (\n                                            <div className=\"results-bubble\" key={k}>\n                                                <OverlayTrigger\n                                                trigger=\"hover\"\n                                                placement=\"right\"\n                                                overlay={\n                                                    <Popover>\n                                                        <Popover.Title as=\"h3\">{\"Details\"}</Popover.Title>\n                                                        <Popover.Content>\n                                                            <strong>Confidence: {Math.round(this.state.testConfidences[k]*10000)/100}%    </strong>\n                                                            <div style={{marginTop:\"5px\"}}></div>\n                                                            <ProgressBar now={Math.round(this.state.testConfidences[k]*10000)/100} variant={this.state.testRanks[k] === 0 ? \"success\" : \"danger\"} />\n                                                        </Popover.Content>\n                                                    </Popover>\n                                                }>\n                                                    <Alert variant={this.state.testRanks === undefined ? \"info\" : this.state.testRanks[k] === 0 ? \"success\" : \"danger\"}>\n                                                        <p align=\"center\" className=\"results-bubble-title\">{k}</p>\n                                                    </Alert>\n                                                </OverlayTrigger>\n                                            </div>\n                                        )\n                                    } else {\n                                        return (\n                                            <div className=\"results-bubble\" key={k}>\n                                                <Alert variant={this.state.testRanks === undefined ? \"info\" : this.state.testRanks[k] === 0 ? \"success\" : \"danger\"}>\n                                                            <p align=\"center\" className=\"results-bubble-title\">{k}</p>\n                                                </Alert>\n                                            </div>\n                                        )\n                                    }\n                                    \n                                })}\n                            </div>\n                        </div>\n                        <div>\n                            <Button onClick={this.exportModel}>Export</Button>\n                        </div>\n                    </header>\n                    <Jumbotron fluid>\n                        <Container>\n                            <h1>Test Results</h1>\n                            <p></p>\n                            {this.state.testResults !== undefined && Object.keys(this.state.testResults).sort().map(label => {\n                                const results = this.state.testResults[label]\n                                return (\n                                    <div className=\"results-row\" key={label}>\n                                        <div className=\"test-label-bubble\" key={label}>\n                                            <Alert variant=\"info\">\n                                                <p align=\"center\" className=\"results-bubble-title\">{label}</p>\n                                            </Alert>\n                                        </div>\n                                        <div className=\"results-cells-wrapper\">\n                                            {results.map(r => {\n                                                const imgUrl = r[0]\n                                                // const img = await this.getImg(imgUrl)\n                                                const confidence = r[1]\n                                                return (\n                                                    <div className=\"results-cell\" key={r}>\n                                                        <img src={imgUrl} width={100} className=\"results-cell-pic\"></img>\n                                                        <ProgressBar now={Math.round(confidence*100)} label={Math.round(confidence*100) + \"%\"}/>\n                                                    </div>\n                                                )\n                                            })}\n                                        </div>\n                                    </div>\n                                    \n                                )\n                            })}\n                        </Container>\n                    </Jumbotron>\n                </div>\n            )\n        }\n\n        \n    }\n}\n\nexport default TestView;\n\n\n\n\n    // freezeModelLayers(trainableLayers, modelModified) {\n    //     // console.log(modelModified.layers)\n    //     for (const layer of modelModified.layers){\n    //         layer.trainable = false;\n    //         for (const tobeTrained of trainableLayers) {\n    //             if (layer.name.indexOf(tobeTrained) === 0) {\n    //                 layer.trainable = true;\n    //                 break;\n    //             }\n    //         }\n    //     }\n    //     // console.log(modelModified.summary())\n    //     return modelModified;\n    // }","import React from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport Label from './Label.js';\nimport LabelView from './LabelView.js';\nimport Loading from './Loading.js';\nimport Navbar from 'react-bootstrap/Navbar';\nimport Nav from 'react-bootstrap/Nav';\nimport { BrowserRouter as Router, Route } from 'react-router-dom';\nimport TestView from './TestView';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n        <Router>\n          <Route exact path=\"/\" component={LabelView} />\n          <Route path=\"/test\" component={TestView} />\n        </Router>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport './fonts/DJB.ttf'\nimport './fonts/Poppins-Regular.otf'\n\nReactDOM.render(\n<App/>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}